<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Turn your boat into a custom sticker, shirt, or any print-on-demand item using AI." />
  <meta name="keywords" content="boat sticker, boat shirt, custom boat print, AI boat art, personalized boat merchandise" />
  <meta name="author" content="Boat2Merch" />
  <title>Boat2Merch — Turn Your Boat into Stickers & Shirts</title>

  <!-- Favicon / App Icon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png?v=3">
  <link rel="stylesheet" href="style.css" />

  <style>
    /* Local tweaks so buttons sit nicely under the text */
    .hero .lead-wrap { max-width: 560px; }
    .hero .controls { justify-content: flex-start; margin-top: 14px; margin-left: 4px; }
    .hero #statusArea { margin-top: 12px; }

    /* ---------- Free-tier limit modal (self-contained styles) ---------- */
    .hidden { display: none !important; }

    .limit-modal {
      position: fixed; inset: 0;
      display: grid; place-items: center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(2px);
      z-index: 1000;
      padding: 18px;
    }
    .limit-card {
      width: 100%;
      max-width: 640px;
      background: radial-gradient(120% 120% at 10% 0%, #262626 0%, #1b1b1b 60%);
      border: 1px solid #333;
      border-radius: 16px;
      box-shadow: 0 24px 60px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.03) inset;
      overflow: hidden;
      position: relative;
    }
    .limit-card .topbar {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 14px; border-bottom: 1px solid #2a2a2a;
      background: linear-gradient(180deg, rgba(255,152,0,.06), rgba(255,152,0,0));
    }
    .limit-card .badge {
      display: inline-flex; align-items: center; gap: 8px;
      font-weight: 800; letter-spacing: .4px;
      background: #2b2b2b; border: 1px solid #3a3a3a; color: #ffb347;
      padding: 8px 12px; border-radius: 999px;
    }
    .limit-card .close-x {
      background: transparent; border: none; color: #bbb; font-size: 22px; cursor: pointer;
      width: 34px; height: 34px; line-height: 34px; border-radius: 8px;
    }
    .limit-card .close-x:hover { background: #2a2a2a; color: #fff; }

    .limit-body {
      padding: 18px 18px 8px 18px;
      display: grid; grid-template-columns: 1fr; gap: 18px;
    }

    .limit-hero {
      display: flex; flex-direction: column; gap: 10px;
    }
    .limit-hero h2 {
      margin: 0; font-size: clamp(1.2rem, 2.6vw, 1.6rem);
    }
    .limit-hero p { margin: 0; color: #cfcfcf; }

    .limit-feats {
      background: #181818; border: 1px solid #2a2a2a; border-radius: 12px;
      padding: 14px;
    }
    .limit-feats h4 { margin: 0 0 8px; color: #ffb347; }
    .limit-feats ul { margin: 0; padding: 0 0 0 18px; color: #cfcfcf; }
    .limit-feats li { margin: 6px 0; }

    .limit-cta {
      display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 12px;
    }
    .limit-price {
      display: inline-flex; align-items: baseline; gap: 8px;
      padding: 10px 12px; border-radius: 12px; background: #222; border: 1px solid #333; color: #ffb347;
      font-weight: 800;
    }
    .limit-price small { color: #bbb; font-weight: 600; }

    .limit-safe {
      display: flex; align-items: center; gap: 10px; color: #aaa; font-size: 13px;
    }
    .limit-safe svg { opacity: .8; }

    .btn-pro {
      background: #ff9800; color: #121212; border: none; border-radius: 10px;
      padding: 12px 16px; font-weight: 800; cursor: pointer;
      box-shadow: 0 10px 22px rgba(255,152,0,.35);
    }
    .btn-pro:hover { transform: translateY(-1px); box-shadow: 0 14px 26px rgba(255,152,0,.45); }
    .btn-ghost.dim { background:#232323; border:1px solid #333; color:#ddd; }
    .btn-ghost.dim:hover { background:#2a2a2a; }

    /* ---------- RIGHT-SIDE account area (badge + auth pill) ---------- */
    .account-area {
      margin-left: auto;              /* push to the far right */
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .plan-badge {
      font-weight: 800;
      font-size: .9rem;
      padding: 6px 12px;
      border-radius: 999px;
      background: #2a2a2a;
      color: #cfcfcf;
      border: 1px solid #353535;
      letter-spacing: .3px;
    }
    .plan-badge.pro {
      background: linear-gradient(135deg,#ffcc33,#ff9800);
      color: #121212;
      box-shadow: 0 0 10px rgba(255,152,0,.55), 0 0 22px rgba(255,152,0,.28);
      border-color: rgba(255,200,80,.6);
    }

    /* Make the signed-in pill match your existing style but compact */
    .signed-in-pill {
      display:flex; align-items:center; gap:8px;
      background:#202020; border:1px solid #2e2e2e; border-radius:999px; padding:6px 10px;
    }
    .signed-in-pill .email {
      white-space: nowrap; max-width: 26ch; overflow: hidden; text-overflow: ellipsis;
      color: #eaeaea; font-size: .9rem;
    }
    .btn.tiny { padding:6px 10px; border-radius:8px; font-size:.8rem; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container nav-row">
      <!-- Left group: brand + nav -->
      <div class="brand">
        <img src="/images/icon.png" class="logo-img" alt="" width="40" height="40" />
        <span>Boat2Merch</span>
      </div>
      <nav class="topnav" aria-label="Primary">
        <a href="index.html" class="active">Home</a>
        <a href="how-it-works.html">How It Works</a>
        <a href="pricing.html">Pricing</a>
        <a href="examples.html">Examples</a>
        <a href="contact.html">Contact</a>
      </nav>

      <!-- Right group: plan badge + auth pill/sign-in -->
      <div class="account-area">
        <span id="planBadge" class="plan-badge">FREE</span>

        <!-- Sign in button (shown when logged out) -->
        <button id="signinBtn" class="btn btn-ghost small">Sign in</button>

        <!-- Signed-in pill (shown when logged in) -->
        <div id="userPill" class="signed-in-pill hidden">
          <span id="userEmail" class="email"></span>
          <button id="signoutBtn" class="btn btn-ghost tiny">Sign out</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-inner">
      <!-- NEW LEFT: Review card (mirrors right-side How it works) -->
      <aside class="card pad review-card" aria-label="Customer review">
        <div class="stars" aria-label="Rated 5 out of 5 stars">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.97l7.19-.62L12 2.8l2.81 6.55 7.19.62-5.46 4.03 1.64 7.03z"/></svg>
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.97l7.19-.62L12 2.8l2.81 6.55 7.19.62-5.46 4.03 1.64 7.03z"/></svg>
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.97l7.19-.62L12 2.8l2.81 6.55 7.19.62-5.46 4.03 1.64 7.03z"/></svg>
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.97l7.19-.62L12 2.8l2.81 6.55 7.19.62-5.46 4.03 1.64 7.03z"/></svg>
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 17.3l-6.18 3.73 1.64-7.03L2 9.97l7.19-.62L12 2.8l2.81 6.55 7.19.62-5.46 4.03 1.64 7.03z"/></svg>
        </div>
        <p class="review-text">
          “Ridiculously clean results. The white outline made our stickers pop — we reordered the same day.”
        </p>
        <div class="reviewer">
          <span class="name">Tyler S.</span> · <span class="meta">Verified boater</span>
        </div>
      </aside>

      <!-- CENTER: copy + controls (unchanged position) -->
      <div class="lead-wrap">
        <h1 class="headline">Turn your boat photo into a clean, die-cut sticker — instantly.</h1>
        <p class="subhead">Upload a photo. Our AI returns a crisp line-art with an optional white contour, ready for stickers, shirts, and more.</p>

        <!-- Hidden system file input -->
        <input type="file" id="boatUpload" accept="image/*" style="display:none" />

        <!-- Buttons under the text (unchanged) -->
        <div class="controls">
          <button class="btn btn-primary btn-generate" id="btnImage">Generate an Image</button>
          <button class="btn btn-secondary btn-generate" id="btnSticker">Generate a Sticker</button>
        </div>

        <!-- Status -->
        <div id="statusArea" aria-live="polite"></div>

        <!-- Result -->
        <div id="resultPanel" class="card pad" style="margin-top:12px; display:none; position: relative;">
          <p class="muted" style="margin:0 0 8px;">Your AI-generated output:</p>
          <div class="result-wrap">
            <img id="resultImage" class="result-img" alt="AI generated boat drawing" />
            <!-- Sign-in gate overlay (only shown when not signed in) -->
            <div id="gate" class="gate hidden" role="dialog" aria-label="Sign in required">
              <div class="gate-box">
                <h3>Sign in to view & download</h3>
                <p class="muted">We’ll email you a secure link — no password needed.</p>
                <button id="gateSignIn" class="btn btn-primary">Continue</button>
                <small class="muted">No spam. One-click sign in.</small>
              </div>
            </div>
          </div>
          <div class="btn-row">
            <a id="downloadBtn" class="btn btn-ghost" download="boat-ai-design.png" aria-disabled="true">Download</a>
          </div>
        </div>
      </div>

      <!-- RIGHT: expanded explainer (existing) -->
      <aside class="card pad">
        <h2 style="margin:0 0 10px;">How it works</h2>
        <ol class="muted" style="margin:10px 0 0; padding-left:18px;">
          <li><strong>Pick your mode:</strong> <em>Generate an Image</em> gives you a clean black-and-white line drawing. <em>Generate a Sticker</em> adds a bold white contour for die-cut stickers.</li>
          <li><strong>Upload a clear photo:</strong> Side or 3/4 views work best. Keep the boat centered with minimal background clutter.</li>
          <li><strong>We process it:</strong> Our model cleans lines, simplifies shapes, and (for stickers) adds the white outline on a transparent background.</li>
          <li><strong>Download or order:</strong> Save the PNG/WebP, or jump straight to checkout for pro-quality die-cut stickers.</li>
          <li class="muted"><small>Tip: Higher-resolution photos = cleaner edges and fewer artifacts.</small></li>
        </ol>
      </aside>
    </div>
  </section>

  <!-- Features -->
  <section class="features">
    <div class="container">
      <div class="feature-grid">
        <div class="feature-card card pad">
          <h3>🎨 Clean Line-Art</h3>
          <p class="muted">High-contrast look that prints beautifully on dark or light surfaces.</p>
        </div>
        <div class="feature-card card pad">
          <h3>🛍 Print-Ready</h3>
          <p class="muted">Transparent background and (optional) white outline — no extra editing needed.</p>
        </div>
        <div class="feature-card card pad">
          <h3>⚡ Fast</h3>
          <p class="muted">Most results are ready in under two minutes. Grab it and go.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta">
    <div class="container">
      <h2 style="margin:0 0 10px;">Ready to try it?</h2>
      <p class="muted" style="margin:0 0 18px;">Choose your mode above and upload a photo.</p>
      <button class="btn btn-primary btn-generate" onclick="document.getElementById('btnImage').click()">Get started</button>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; 2025 Boat2Merch · All rights reserved.</p>
    </div>
  </footer>

  <!-- Sign-in Modal (magic-link) -->
  <div id="authModal" class="auth-modal hidden" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <div class="auth-card">
      <button class="auth-close" id="authClose" aria-label="Close">×</button>
      <h2 id="authTitle" style="margin:0 0 8px;">Sign in</h2>
      <p class="muted" style="margin:0 0 14px;">We’ll email you a secure link. No password needed.</p>
      <form id="authForm">
        <label for="authEmail" class="sr-only">Email</label>
        <input type="email" id="authEmail" placeholder="you@example.com" required />
        <button type="submit" class="btn btn-primary" id="authSubmit">Send magic link</button>
      </form>
      <div id="authNote" class="muted tiny" style="margin-top:10px;"></div>
    </div>
  </div>

  <!-- Free tier LIMIT Modal -->
  <div id="limitModal" class="limit-modal hidden" role="dialog" aria-modal="true" aria-labelledby="limitTitle">
    <div class="limit-card">
      <div class="topbar">
        <span class="badge">🚀 Pro unlock</span>
        <button class="close-x" id="limitClose" aria-label="Close">×</button>
      </div>
      <div class="limit-body">
        <div class="limit-hero">
          <h2 id="limitTitle">You've hit the free limit</h2>
          <p>Upgrade to <strong>Boat2Merch Pro</strong> to keep generating and get a smoother workflow.</p>

          <div class="limit-feats">
            <h4>Pro includes</h4>
            <ul>
              <li><strong>Unlimited image generations</strong></li>
              <li>Priority processing in the queue</li>
              <li>Higher-resolution output</li>
              <li>Early access to new features</li>
            </ul>
          </div>

          <div class="limit-cta">
            <span class="limit-price">$7 <small>/ month</small></span>
            <button id="limitGoPro" class="btn-pro">Unlock Pro</button>
            <button id="limitMaybe" class="btn btn-ghost dim">Maybe later</button>
          </div>

          <div class="limit-safe">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 2L2 7v6c0 5 3.8 9.7 10 11 6.2-1.3 10-6 10-11V7l-10-5Z" stroke="currentColor" stroke-width="1.3"/><path d="M8 12l2.5 2.5L16 9" stroke="currentColor" stroke-width="1.6"/></svg>
            <span>Secure checkout via Stripe. Cancel anytime.</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tiny toast -->
  <div id="toast" class="toast hidden"></div>

  <!-- Scripts -->
  <script>
    const boatUpload = document.getElementById("boatUpload");
    const btnImage = document.getElementById("btnImage");
    const btnSticker = document.getElementById("btnSticker");
    const statusArea = document.getElementById("statusArea");
    const resultPanel = document.getElementById("resultPanel");
    const resultImage = document.getElementById("resultImage");
    const downloadBtn = document.getElementById("downloadBtn");
    const gate = document.getElementById("gate");
    const gateSignIn = document.getElementById("gateSignIn");

    // Right-side account widgets
    const signinBtn = document.getElementById("signinBtn");
    const userPill = document.getElementById("userPill");
    const userEmailEl = document.getElementById("userEmail");
    const signoutBtn = document.getElementById("signoutBtn");
    const planBadge = document.getElementById("planBadge");

    const authModal = document.getElementById("authModal");
    const authClose = document.getElementById("authClose");
    const authForm = document.getElementById("authForm");
    const authEmail = document.getElementById("authEmail");
    const authSubmit = document.getElementById("authSubmit");
    const authNote = document.getElementById("authNote");
    const toast = document.getElementById("toast");

    // Limit modal
    const limitModal = document.getElementById("limitModal");
    const limitClose = document.getElementById("limitClose");
    const limitMaybe = document.getElementById("limitMaybe");
    const limitGoPro = document.getElementById("limitGoPro");

    let currentMode = "image"; // "image" | "sticker"
    let isAuthed = false;

    // --------------- helpers ---------------
    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 2600);
    }
    function openAuth() {
      authModal.classList.remove("hidden");
      setTimeout(() => authEmail.focus(), 0);
    }
    function closeAuth() {
      authModal.classList.add("hidden");
      authForm.reset();
      authNote.textContent = "";
    }
    async function fetchJSON(url, opts) {
      const r = await fetch(url, opts);
      const t = await r.text();
      try { return { ok: r.ok, status: r.status, json: JSON.parse(t) }; }
      catch { return { ok: r.ok, status: r.status, json: t }; }
    }
    function setAuthedState(email) {
      isAuthed = !!email;
      if (isAuthed) {
        signinBtn.classList.add("hidden");
        userPill.classList.remove("hidden");
        userEmailEl.textContent = email;
        gate.classList.add("hidden");
        downloadBtn.removeAttribute("aria-disabled");
      } else {
        signinBtn.classList.remove("hidden");
        userPill.classList.add("hidden");
        userEmailEl.textContent = "";
      }
    }
    function setPlanBadge(plan) {
      const p = (plan || "free").toLowerCase();
      if (p === "pro") {
        planBadge.textContent = "PRO";
        planBadge.classList.add("pro");
      } else {
        planBadge.textContent = "FREE";
        planBadge.classList.remove("pro");
      }
    }
    function showLimitModal() {
      limitModal.classList.remove("hidden");
    }
    function hideLimitModal() {
      limitModal.classList.add("hidden");
    }

    async function checkSession() {
      try {
        const { ok, json } = await fetchJSON("/auth/session");
        if (ok && json && json.user && json.user.email) {
          setAuthedState(json.user.email);
        } else {
          setAuthedState(null);
        }
      } catch {
        signinBtn.classList.add("hidden");
        userPill.classList.add("hidden");
      }
    }

    async function checkPlan() {
      try {
        const { ok, json } = await fetchJSON("/me/plan");
        if (ok && json && json.plan) {
          setPlanBadge(json.plan);
        } else {
          setPlanBadge("free");
        }
      } catch {
        setPlanBadge("free");
      }
    }

    // --------------- Auth UI wiring ---------------
    signinBtn?.addEventListener("click", openAuth);
    gateSignIn?.addEventListener("click", openAuth);
    authClose?.addEventListener("click", closeAuth);
    authModal?.addEventListener("click", (e) => { if (e.target === authModal) closeAuth(); });

    authForm?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = authEmail.value.trim();
      if (!email) return;

      authSubmit.disabled = true;
      authSubmit.textContent = "Sending…";
      authNote.textContent = "";

      const { ok, json } = await fetchJSON("/auth/send-link", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });

      authSubmit.disabled = false;
      authSubmit.textContent = "Send magic link";

      if (ok) {
        authNote.textContent = "Check your email for the sign-in link.";
      } else {
        authNote.textContent = (json && json.error) ? json.error : "Could not send link right now.";
      }
    });

    signoutBtn?.addEventListener("click", async () => {
      const { ok } = await fetchJSON("/auth/signout", { method: "POST" });
      if (ok) {
        setAuthedState(null);
        setPlanBadge("free");
        showToast("Signed out");
      }
    });

    // Limit modal wiring
    limitClose?.addEventListener("click", hideLimitModal);
    limitMaybe?.addEventListener("click", hideLimitModal);
    limitModal?.addEventListener("click", (e) => { if (e.target === limitModal) hideLimitModal(); });

    // PRO checkout from modal (POST -> /pro/checkout, then redirect to Stripe)
    async function goProCheckout() {
      try {
        const { ok, json } = await fetchJSON("/pro/checkout", { method: "POST" });
        if (ok && json && json.url) {
          window.location.href = json.url;
          return;
        }
        showToast("Unable to start checkout.");
      } catch {
        showToast("Unable to start checkout.");
      }
    }
    limitGoPro?.addEventListener("click", goProCheckout);

    // --------------- Generate buttons ---------------
    btnImage.addEventListener("click", () => { currentMode = "image"; boatUpload.click(); });
    btnSticker.addEventListener("click", () => { currentMode = "sticker"; boatUpload.click(); });

    // Handle upload + polling
    boatUpload.addEventListener("change", async () => {
      if (boatUpload.files.length === 0) return;

      // Reset UI
      resultPanel.style.display = "none";
      statusArea.innerHTML = `
        <div class="loading-container">
          <div class="spinner" aria-hidden="true"></div>
          <div>Uploading and generating (${currentMode})… This can take up to 2 minutes.</div>
        </div>
      `;

      const file = boatUpload.files[0];
      const fd = new FormData();
      fd.append("boatImage", file);
      fd.append("mode", currentMode);

      try {
        // 1) kick off generation
        const up = await fetch("/generate-image", { method: "POST", body: fd });

        // If we’re rate-limited by the server, show the Pro modal and stop.
        if (up.status === 429) {
          statusArea.innerHTML = "";
          showLimitModal();
          boatUpload.value = "";
          return;
        }

        if (!up.ok) throw new Error("Upload failed");

        const { prediction } = await up.json();
        const predictionId = prediction?.id;
        if (!predictionId) throw new Error("No prediction ID returned");

        // 2) poll status
        const pollInterval = 2000;
        const maxAttempts = 30;
        let attempts = 0;

        async function poll() {
          attempts++;
          const resp = await fetch(`/prediction-status/${predictionId}?mode=${currentMode}`);

          if (resp.status === 429) {
            statusArea.innerHTML = "";
            showLimitModal();
            return;
          }

          const statusData = await resp.json();

          if (statusData.status === "succeeded" && statusData.output?.length) {
            const imageUrl = statusData.output[0];

            // Update UI
            statusArea.innerHTML = "";
            resultImage.src = imageUrl;
            resultPanel.style.display = "block";

            // Gate: if not signed in, blur + disable actions
            if (!isAuthed) {
              gate.classList.remove("hidden");
              downloadBtn.setAttribute("aria-disabled", "true");
              downloadBtn.removeAttribute("href");
              downloadBtn.removeAttribute("download");
            } else {
              gate.classList.add("hidden");
              downloadBtn.href = imageUrl;
              downloadBtn.setAttribute("download", "boat-ai-design.png"); // <-- force download
              downloadBtn.removeAttribute("aria-disabled");
            }

          } else if (statusData.status === "failed") {
            statusArea.innerHTML = `<div class="card pad" style="border-color:#733;">Generation failed. Please try a different photo.</div>`;
          } else {
            if (attempts < maxAttempts) {
              setTimeout(poll, pollInterval);
            } else {
              statusArea.innerHTML = `<div class="card pad" style="border-color:#735;">Generation timed out. Please try again later.</div>`;
            }
          }
        }

        poll();
      } catch (err) {
        console.error(err);
        statusArea.innerHTML = `<div class="card pad" style="border-color:#733;">Error: ${err.message}</div>`;
      } finally {
        boatUpload.value = "";
      }
    });

    // Kick off session + plan checks on load
    checkSession().then(checkPlan);

    // If you redirect back after magic link verify with ?login=ok
    if (new URLSearchParams(location.search).get("login") === "ok") {
      showToast("You're signed in!");
      const url = new URL(location.href);
      url.searchParams.delete("login");
      history.replaceState({}, "", url);
      // Refresh both session + plan
      checkSession().then(checkPlan);
    }
  </script>
</body>
</html>
