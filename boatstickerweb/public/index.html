<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Turn your boat into a custom sticker, shirt, or any print-on-demand item using AI." />
  <meta name="keywords" content="boat sticker, boat shirt, custom boat print, AI boat art, personalized boat merchandise" />
  <meta name="author" content="Boat2Merch" />
  <title>Boat2Merch ‚Äî Turn Your Boat into Stickers & Shirts</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container nav-row">
      <div class="brand">
        <span class="logo-emoji">üö§</span> Boat2Merch
      </div>
      <nav class="topnav" aria-label="Primary">
        <a href="index.html" class="active">Home</a>
        <a href="how-it-works.html">How It Works</a>
        <a href="pricing.html">Pricing</a>
        <a href="examples.html">Examples</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-inner">
      <!-- Left: copy + controls -->
      <div>
        <h1 class="headline">Turn your boat photo into a clean, die-cut sticker ‚Äî instantly.</h1>
        <p class="subhead">Upload a photo. Our AI returns a crisp line-art with an optional white contour, ready for stickers, shirts, and more.</p>

        <!-- Action card -->
        <div class="card pad" role="region" aria-label="Upload and settings">
          <!-- Hidden system file input -->
          <input type="file" id="boatUpload" accept="image/*" style="display:none" />

          <div class="controls">
            <button class="btn btn-primary" id="btnImage">Generate an Image</button>
            <button class="btn btn-secondary" id="btnSticker">Generate a Sticker</button>
            <button class="btn btn-ghost" id="editBtn">Buy as a sticker</button>
          </div>

          <!-- Status -->
          <div id="statusArea" style="margin-top:12px;" aria-live="polite"></div>

          <!-- Result -->
          <div id="resultPanel" class="card pad" style="margin-top:12px; display:none;">
            <p class="muted" style="margin:0 0 8px;">Your AI-generated output:</p>
            <img id="resultImage" class="result-img" alt="AI generated boat drawing" />
            <div class="btn-row">
              <a id="downloadBtn" class="btn btn-ghost" download="boat-ai-design.png">Download</a>
              <button id="buyBtn" class="btn btn-secondary">Buy as a sticker</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: expanded explainer -->
      <aside class="card pad">
        <h2 style="margin:0 0 10px;">How it works</h2>
        <ol class="muted" style="margin:10px 0 0; padding-left:18px;">
          <li><strong>Pick your mode:</strong> <em>Generate an Image</em> gives you a clean black-and-white line drawing. <em>Generate a Sticker</em> adds a bold white contour for die-cut stickers.</li>
          <li><strong>Upload a clear photo:</strong> Side or 3/4 views work best. Keep the boat centered with minimal background clutter.</li>
          <li><strong>We process it:</strong> Our model cleans lines, simplifies shapes, and (for stickers) adds the white outline on a transparent background.</li>
          <li><strong>Download or order:</strong> Save the PNG/WebP, or jump straight to checkout for pro-quality die-cut stickers.</li>
          <li class="muted"><small>Tip: Higher-resolution photos = cleaner edges and fewer artifacts.</small></li>
        </ol>
      </aside>
    </div>
  </section>

  <!-- Features -->
  <section class="features">
    <div class="container">
      <div class="feature-grid">
        <div class="feature-card card pad">
          <h3>üé® Clean Line-Art</h3>
          <p class="muted">High-contrast look that prints beautifully on dark or light surfaces.</p>
        </div>
        <div class="feature-card card pad">
          <h3>üõç Print-Ready</h3>
          <p class="muted">Transparent background and (optional) white outline ‚Äî no extra editing needed.</p>
        </div>
        <div class="feature-card card pad">
          <h3>‚ö° Fast</h3>
          <p class="muted">Most results are ready in under two minutes. Grab it and go.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <section class="cta">
    <div class="container">
      <h2 style="margin:0 0 10px;">Ready to try it?</h2>
      <p class="muted" style="margin:0 0 18px;">Choose your mode above and upload a photo.</p>
      <button class="btn btn-primary" onclick="document.getElementById('btnImage').click()">Get started</button>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; 2025 Boat2Merch ¬∑ All rights reserved.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    const boatUpload = document.getElementById("boatUpload");
    const btnImage = document.getElementById("btnImage");
    const btnSticker = document.getElementById("btnSticker");
    const editBtn = document.getElementById("editBtn");
    const statusArea = document.getElementById("statusArea");
    const resultPanel = document.getElementById("resultPanel");
    const resultImage = document.getElementById("resultImage");
    const downloadBtn = document.getElementById("downloadBtn");
    const buyBtn = document.getElementById("buyBtn");

    let currentMode = "image"; // "image" | "sticker"

    // Button handlers set mode and open file dialog
    btnImage.addEventListener("click", () => { currentMode = "image"; boatUpload.click(); });
    btnSticker.addEventListener("click", () => { currentMode = "sticker"; boatUpload.click(); });

    // Handle upload + polling
    boatUpload.addEventListener("change", async () => {
      if (boatUpload.files.length === 0) return;

      // Reset UI
      resultPanel.style.display = "none";
      editBtn.classList.remove("visible");
      statusArea.innerHTML = `
        <div class="loading-container">
          <div class="spinner" aria-hidden="true"></div>
          <div>Uploading and generating (${currentMode})‚Ä¶ This can take up to 2 minutes.</div>
        </div>
      `;

      const file = boatUpload.files[0];
      const formData = new FormData();
      formData.append("boatImage", file);
      formData.append("mode", currentMode); // BACKEND will switch prompts based on this

      try {
        const uploadResp = await fetch("/generate-image", { method: "POST", body: formData });
        if (!uploadResp.ok) throw new Error("Upload failed");

        const { prediction } = await uploadResp.json();
        const predictionId = prediction?.id;
        if (!predictionId) throw new Error("No prediction ID returned");

        const pollInterval = 2000; // ms
        const maxAttempts = 30;
        let attempts = 0;

        async function poll() {
          attempts++;
          const statusResp = await fetch(`/prediction-status/${predictionId}`);
          const statusData = await statusResp.json();

          if (statusData.status === "succeeded" && statusData.output?.length) {
            const imageUrl = statusData.output[0];

            // Update UI
            statusArea.innerHTML = "";
            resultImage.src = imageUrl;
            downloadBtn.href = imageUrl;
            resultPanel.style.display = "block";

            // Buttons: both go to buy
            editBtn.classList.add("visible");
            const goBuy = () => window.location.href = "buy.html?img=" + encodeURIComponent(imageUrl);
            editBtn.onclick = goBuy;
            buyBtn.onclick = goBuy;

          } else if (statusData.status === "failed") {
            statusArea.innerHTML = `<div class="card pad" style="border-color:#733;">Generation failed. Please try a different photo.</div>`;
          } else {
            if (attempts < maxAttempts) {
              setTimeout(poll, pollInterval);
            } else {
              statusArea.innerHTML = `<div class="card pad" style="border-color:#735;">Generation timed out. Please try again later.</div>`;
            }
          }
        }

        poll();
      } catch (err) {
        console.error(err);
        statusArea.innerHTML = `<div class="card pad" style="border-color:#733;">Error: ${err.message}</div>`;
      } finally {
        // clear the input so selecting the same file again re-triggers change
        boatUpload.value = "";
      }
    });
  </script>
</body>
</html>
